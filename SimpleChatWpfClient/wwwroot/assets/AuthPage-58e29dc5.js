import{u as n,v as p}from"./index-bc05f82b.js";import{p as h,g as C,l as g,c as a,o as R,a as x,w as o,b as c,k as F,j as k}from"./index-7e0ef185.js";import{V as P}from"./VMain-ffc5ac57.js";import{V as T,a as A}from"./VRow-8649b514.js";import{V as N,a as j}from"./VCard-4320fbb2.js";import{a as B,V as I}from"./VToolbar-23df3aee.js";import{m as O,u as U}from"./tag-1a61e89d.js";import{m as $,c as q,V as b}from"./VTextField-c1b0e354.js";import{f as D}from"./forwardRefs-f0d558be.js";import{V as v}from"./VBtn-3a8c1ea3.js";import{V as L}from"./VContainer-e7ac744a.js";import"./_commonjsHelpers-042e6b4d.js";const S=h({...O(),...$()},"VForm"),J=C()({name:"VForm",props:S(),emits:{"update:modelValue":i=>!0,submit:i=>!0},setup(i,l){let{slots:r,emit:V}=l;const m=q(i),f=g();function t(s){s.preventDefault(),m.reset()}function e(s){const d=s,u=m.validate();d.then=u.then.bind(u),d.catch=u.catch.bind(u),d.finally=u.finally.bind(u),V("submit",d),d.defaultPrevented||u.then(w=>{var y;let{valid:_}=w;_&&((y=f.value)==null||y.submit())}),d.preventDefault()}return U(()=>{var s;return a("form",{ref:f,class:["v-form",i.class],style:i.style,novalidate:!0,onReset:t,onSubmit:e},[(s=r.default)==null?void 0:s.call(r,m)])}),D(m,f)}}),M={class:"d-flex justify-end"},te={__name:"AuthPage",setup(i){const l=g(""),r=g("");async function V(){const t=await n.api.auth.superAdminLogin(l.value,r.value);if(t.isOk){const e=t.value;p.state.JWT=e.token,p.state.userId=-114514,p.state.userName=l,p.state.userProfile={id:-114514,userName:l,nickname:"超级管理员",avatar:"",description:"",isAdmin:!0},k.push("/admin")}else n.tool.toast(t.message)}async function m(){const t=await n.api.auth.register(l.value,r.value);t.isOk?n.tool.toast("注册成功, 待管理员审核后即可登录"):n.tool.toast(t.message)}async function f(){const t=await n.api.auth.login(l.value,r.value);if(t.isOk){const e=t.value;n.auth.saveAuthInfo(e.userId,e.userName,e.userProfile,e.token),k.push("/main")}else n.tool.toast(t.message)}return(t,e)=>(R(),x(P,null,{default:o(()=>[a(L,{class:"fluid fill-height"},{default:o(()=>[a(T,{"align-center":"",justify:"center"},{default:o(()=>[a(A,{cols:6,lg:"6",sm:"8"},{default:o(()=>[a(N,{"justify-center":"",class:"mx-auto"},{default:o(()=>[a(B,{color:"primary"},{default:o(()=>[a(I,null,{default:o(()=>[c(" Auth ")]),_:1})]),_:1}),a(j,null,{default:o(()=>[a(J,null,{default:o(()=>[a(b,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),name:"username",label:"Username",type:"text",placeholder:"username",required:""},null,8,["modelValue"]),a(b,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s),name:"password",label:"Password",type:"password",placeholder:"password",required:""},null,8,["modelValue"]),F("div",M,[a(v,{onClick:e[2]||(e[2]=s=>V())},{default:o(()=>[c("Admin")]),_:1}),a(v,{onClick:e[3]||(e[3]=s=>m()),class:"ms-2"},{default:o(()=>[c(" Register ")]),_:1}),a(v,{onClick:e[4]||(e[4]=s=>f()),color:"primary",class:"ms-2"},{default:o(()=>[c(" Login ")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{te as default};
