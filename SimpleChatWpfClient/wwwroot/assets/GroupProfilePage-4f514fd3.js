import{l as _,ad as j,o as c,a as p,w as e,c as t,k as d,u as r,t as k,b as u,d as $,I as x,F as O,e as T}from"./index-7e0ef185.js";import{a as V,V as v,u as a,v as C}from"./index-bc05f82b.js";import{V as H}from"./VMain-ffc5ac57.js";import{V as G,a as I,c as U}from"./VCard-4320fbb2.js";import{V as y}from"./forwardRefs-f0d558be.js";import{V as f}from"./VBtn-3a8c1ea3.js";import{V as m}from"./VTooltip-d7ce11d9.js";import{V as z,a as B}from"./VList-c42ec69f.js";import{V as J}from"./VContainer-e7ac744a.js";import"./_commonjsHelpers-042e6b4d.js";import"./tag-1a61e89d.js";import"./VOverlay-c00d4473.js";const K={class:"d-flex align-start"},Q={class:"ms-4"},W={class:"text-h6"},X={class:"mt-8"},Y={class:"mt-4"},ce={__name:"GroupProfilePage",setup(Z){const q=_(!1),i=_({}),w=_([]),h=_([]),F=j(),g=Number.parseInt(F.params.id);async function D(){await a.api.group.getGroupProfile(g).then(l=>{l.isOk?i.value=l.value:a.tool.toast(l.message)})}async function A(){await a.api.group.getGroupMembers(g).then(l=>{l.isOk?w.value=l.value:a.tool.toast(l.message)})}async function P(){await a.api.group.getGroupMembersIsAdmin(g).then(l=>{l.isOk?h.value=l.value:a.tool.toast(l.message)})}async function L(){a.api.group.checkUserIsGroupAdmin(C.state.userProfile.id).then(l=>{l.isOk?q.value=l.value:a.tool.toast(l.message)})}async function S(l){let n=await a.api.group.checkUserInGroup(l);if(!n.isOk){a.tool.toast(n.message);return}if(!n.value){let s=await a.api.request.requestGroup(l);if(s.isOk)a.tool.toast("已发送加群请求, 等待验证");else{a.tool.toast(s.message);return}}}async function M(l,n){let o=await a.api.group.deleteGroupMember(l,n);if(!o.isOk){a.tool.toast(o.message);return}a.tool.toast("已删除群成员"),await A()}async function N(l,n,o){let s=await a.api.group.setGroupAdmin(l,n,o);if(!s.isOk){a.tool.toast(s.message);return}a.tool.toast("已设置为管理员"),await P()}async function E(){await D(),await A(),await P(),await L()}return E(),(l,n)=>(c(),p(H,null,{default:e(()=>[t(J,null,{default:e(()=>[t(G,null,{default:e(()=>[t(I,null,{default:e(()=>[d("div",K,[d("div",null,[t(y,{size:"x-large"},{default:e(()=>[t(V,{src:r(a).info.getAvatar(i.value.avatar)},null,8,["src"])]),_:1})]),d("div",Q,[d("div",W,k(i.value.name),1),d("div",null,k(i.value.id),1)])]),d("div",X,k(i.value.description||"群主很懒，什么都没有留下"),1),d("div",Y,[t(f,{icon:"",onClick:n[0]||(n[0]=o=>S(i.value.id))},{default:e(()=>[t(v,{color:"primary"},{default:e(()=>[u("mdi-chat")]),_:1}),t(m,{activator:"parent"},{default:e(()=>[u("聊天")]),_:1})]),_:1})])]),_:1})]),_:1}),t(G,{class:"mt-4"},{default:e(()=>[t(U,null,{default:e(()=>[u("群管理员")]),_:1}),t(I,null,{default:e(()=>[t(z,null,{default:e(()=>[(c(!0),$(O,null,x(h.value,o=>(c(),p(B,{key:o.id,title:r(a).info.getUserFullDisplayName(o.userName,o.nickname),subtitle:o.id},{prepend:e(()=>[t(f,{icon:"",onClick:s=>r(a).router.goToUserProfile(o.id),class:"me-3"},{default:e(()=>[t(y,null,{default:e(()=>[t(V,{src:r(a).info.getAvatar(o.avatar)},null,8,["src"])]),_:2},1024)]),_:2},1032,["onClick"])]),append:e(()=>[t(f,{icon:"",size:"small",onClick:s=>M(i.value.id,o.id)},{default:e(()=>[t(v,{icon:"mdi-account-cancel",color:"red"}),t(m,{activator:"parent"},{default:e(()=>[u("踢出群成员")]),_:1})]),_:2},1032,["onClick"]),r(C).state.userId==i.value.creatorId?(c(),p(f,{key:0,icon:"",size:"small",class:"ms-2",onClick:s=>r(a).router.goToUserProfile(o.id)},{default:e(()=>[t(v,{icon:"mdi-account-edit",color:"orange",onClick:s=>N(i.value.id,o.id,!1)},null,8,["onClick"]),t(m,{activator:"parent"},{default:e(()=>[u("取消管理员")]),_:1})]),_:2},1032,["onClick"])):T("",!0)]),_:2},1032,["title","subtitle"]))),128))]),_:1})]),_:1})]),_:1}),t(G,{class:"mt-4"},{default:e(()=>[t(U,null,{default:e(()=>[u("群成员")]),_:1}),t(I,null,{default:e(()=>[t(z,null,{default:e(()=>[(c(!0),$(O,null,x(w.value,o=>(c(),p(B,{key:o.id,title:r(a).info.getUserFullDisplayName(o.userName,o.nickname),subtitle:o.id},{prepend:e(()=>[t(f,{icon:"",onClick:s=>r(a).router.goToUserProfile(o.id),class:"me-3"},{default:e(()=>[t(y,null,{default:e(()=>[t(V,{src:r(a).info.getAvatar(o.avatar)},null,8,["src"])]),_:2},1024)]),_:2},1032,["onClick"])]),append:e(()=>[t(f,{icon:"",size:"small",onClick:s=>M(i.value.id,o.id)},{default:e(()=>[t(v,{icon:"mdi-account-cancel",color:"red"}),t(m,{activator:"parent"},{default:e(()=>[u("踢出群成员")]),_:1})]),_:2},1032,["onClick"]),r(C).state.userId==i.value.creatorId?(c(),p(f,{key:0,icon:"",size:"small",class:"ms-2",onClick:s=>r(a).router.goToUserProfile(o.id)},{default:e(()=>[t(v,{icon:"mdi-account-edit",color:"green",onClick:s=>N(i.value.id,o.id,!0)},null,8,["onClick"]),t(m,{activator:"parent"},{default:e(()=>[u("设为管理员")]),_:1})]),_:2},1032,["onClick"])):T("",!0)]),_:2},1032,["title","subtitle"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}};export{ce as default};
